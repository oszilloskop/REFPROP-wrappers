*************************
MATLAB wrapper of REFPROP
*************************

Updated wrapper by Ian Bell, NIST, 2016

==============
Pre-requisites
==============

* MATLAB
* A licensed version of NIST REFPROP

======================
Problems with wrapper?
======================

* File an issue at https://github.com/usnistgov/REFPROP-wrappers/issues

=======================
Instructions on windows
=======================

1. Install REFPROP as normal.  (default installation directory on 64-bit windows is ``c:/Program Files (x86)/REFPROP``, or ``c:/Program Files/REFPROP`` on 32-bit windows)
2. If you have a 64-bit MATLAB version, make sure you have a ``REFPRP64.dll`` file in your REFPROP installation directory.  If not, email ian.bell@nist.gov with your license information.
3. Place the ``REFPROP.h`` that you can obtain from `REFPROP.h <https://raw.githubusercontent.com/usnistgov/REFPROP-wrappers/master/wrappers/MATLAB/legacy/REFPROP.h>`_ in the REFPROP installation directory
4. Place `refpropm.m <https://raw.githubusercontent.com/usnistgov/REFPROP-wrappers/master/wrappers/MATLAB/refpropm.m>`_ in your REFPROP installation directory (so that it sits next to ``refprop.dll``).  Make sure to add this directory to your `MATLAB path <https://www.mathworks.com/help/matlab/ref/path.html>`_ (but do not recursively add subfolders).  Do not place refpropm.m in your working directory; ONLY place it in the REFPROP installation directory.
5. If you did not use the version 9.1.1 patch installer, obtain the following files and place each of them in the your REFPROP installation directory (so they sit next to refprop.dll):

    * `REFPRP64_thunk_pcwin64.dll <https://trc.nist.gov/refprop/FAQ/MATLAB/9.1.1/REFPRP64_thunk_pcwin64.dll>`_

    * `rp_proto64.m <https://trc.nist.gov/refprop/FAQ/MATLAB/9.1.1/rp_proto64.m>`_

6. Test your refpropm file with something like (the normal boiling point temperature of water at one atmosphere, or 101.325 kPa)::

    >> refpropm('T','P',101.325,'Q',0,'WATER')

    ans =

      373.1243

Potential problems
------------------

* If you have not installed REFPROP in the standard location, modify the block of code that reads like::

    if strcmp(computer, 'PCWIN64')
        BasePath = 'C:\Program Files (x86)\REFPROP\';
        dllName = 'REFPRP64.dll';
    else
        if strcmp(computer, 'PCWIN32')
            BasePath = 'C:\Program Files\REFPROP\';
            dllName = 'REFPROP.dll';
        else
            error(strcat('Architecture[',computer,'] is not understood'));
        end
    end

  with the appropriate ``BasePath`` for your system

* If you don't have a valid compiler for MATLAB, you will need to use a prototype file. To create it, run the following command in MATLAB on a computer with a valid compiler::

    >> loadlibrary('REFPRP64.dll', 'REFPROP.h', 'mfilename', 'rp_proto64.m')

=========================
Instructions on OSX/linux
=========================
 
1. Make a folder called ``refprop`` in your home directory (case sensitive!).  For me I made the folder ``/home/ihb/refprop``
2. Into that folder place the ``MIXTURES`` and ``FLUIDS`` directories from REFPROP, making each directory all lowercase (e.g., ``fluids`` and ``mixtures``)
3. [OSX only] Obtain a build of REFPROP for OSX, by compiling it yourself (see https://github.com/usnistgov/REFPROP-cmake.  If you have any problems with the build, please file an issue here: https://github.com/usnistgov/REFPROP-cmake/issues). Put the ``libREFPRP64.dylib`` in the ``refprop`` directory in your home directory (but rename it to ``librefprop.dylib``)
4. [linux only] Put the ``libREFPRP64.so`` that you built yourself (see https://github.com/usnistgov/REFPROP-cmake) in the ``refprop`` directory in your home directory (but rename it to ``librefprop.so``)
5. Put the header ``REFPROP.h`` that is auto-generated by the REFPROP-cmake build (or provided with shared library) in the refprop directory

So in the ``${HOME}/refprop`` folder you should have a structure like::

    ${HOME}/refprop
    ├── fluids
    │   ├── 1BUTENE.FLD
    │   ├── ACETONE.FLD
    │   …
    ├── librefprop.so (or librefprop.dylib on OSX)
    ├── mixtures
    │   ├── AIR.MIX
    │   ├── AMARILLO.MIX
    │   …
    └── REFPROP.h

6. Test your refpropm file with something like (the normal boiling point temperature of water at one atmosphere, or 101.325 kPa)::

    >> refpropm('T','P',101.325,'Q',0,'WATER')

    ans =

      373.1243
